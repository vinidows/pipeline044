name: Deploy no K8S_CONFIG
on:
    workflow_call:
        inputs:
            environment-name:
                name:
                  type: string
                  required: true

jobs:
    Deploy:
      name: "Deploy"
      runs-on: ubuntu-latest
      environment:
          name: ${{ inputs.environment.name }}
      steps:
      - name: Checkout do codigo
        uses: actions/checkout@v5.0.0

      - name: Configuração do Kubernetes
        uses: azure/k8s-set-context@v4
        with:
          method: kubeconfig
          kubeconfig: ${{ secrets.K8S_CONFIG }}


      - name: Deploy do manifesto
        uses: Azure/k8s-deploy@v5
        with:
          namespace: ${{ secrets.K8S_NAMESPACE}}
          manifests: k8s/deployment.yaml
          images: vinidows/pipeline044:v${{ github.run_number }}
