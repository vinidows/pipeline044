name: Deploy no K8S_CONFIG
on:
    workflow_call:
        inputs:
            manifests:
                type: string
                required: true
                description: "Arquivos de manifesto para o deploy"
            images:
                type: string
                required: true
                description: "Images que serão alterado no manifesto"
            environment:
                type: string
                required: true
                description: "nome do ambiente"

jobs:
    Deploy-k8s:
      runs-on: ubuntu-latest
      environment: ${{ inputs.environment }}
      steps:
      - name: Checkout do codigo
        uses: actions/checkout@v5.0.0      
      - name: Configuração do Kubernetes
        uses: azure/k8s-set-context@v4
        with:
          method: kubeconfig
          kubeconfig: ${{ secrets.K8S_CONFIG }}


      - name: Execução do manifesto
        uses: Azure/k8s-deploy@v5
        with:
          namespace: ${{ secrets.K8S_NAMESPACE}}
          manifests: ${{ inputs.manifests }}
          images: ${{ inputs.images }}
          namespace: ${{ vars.APP_NAMESPACE }}
